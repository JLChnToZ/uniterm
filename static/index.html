<!DOCTYPE html>
<html>
<head>
<title>hterm Electron Client</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
<style type="text/css">
html, body {
  width: 100%;
  height: 100%;
  border: none;
  margin: 0;
  padding: 0;
}
</style>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', () => {
  const { hterm, lib } = require('hterm-umdjs');

  // Initialize the terminal
  hterm.defaultStorage = new lib.Storage.Local();
  const terminal = new hterm.Terminal('default');

  terminal.onTerminalReady =
    EventTarget.prototype.dispatchEvent.bind(
      document, new CustomEvent('terminalready', {
        detail: { terminal }
      })
    );

  // Tweak the empty title changes
  window.defaultTitle = document.title;
  terminal.setWindowTitle = title => {
    window.document.title = title.trim() || window.defaultTitle;
  };

  // Apply the teminal to DOM
  terminal.decorate(document.body);

  // Expose for debugging
  window.terminal = terminal;
});
document.addEventListener('terminalready', e => {
  const { ipcRenderer } = require('electron');
  const { terminal } = e.detail;
  const io = terminal.io.push();

  // Map terminal IO to IPC channel
  ipcRenderer.on('end', () => window.close());
  ipcRenderer.on('settitle', (e, title) => {
    window.document.title = window.defaultTitle = title;
  });
  ipcRenderer.on('output', (e, data) => io.print(data));
  io.onVTKeystroke = io.sendString =
    ipcRenderer.send.bind(null, 'input');
  io.onTerminalResize =
    ipcRenderer.send.bind(null, 'resize');
  ipcRenderer.send('terminal-ready');

  terminal.installKeyboard();

  // Decorate the terminal
  const prefs = terminal.getPrefs();
  require('../lib/frontend/shell-defaults').init(prefs);
});
function dropBlocker(e) {
  e.preventDefault();
  e.stopPropagation();
  if(e.dataTransfer)
    e.dataTransfer.dropEffect = 'none';
  return false;
}
document.addEventListener('dragover', dropBlocker, false);
document.addEventListener('drop', dropBlocker, false);
</script>
</head>
</html>
