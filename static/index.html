<!DOCTYPE html>
<html>
<head>
<title>hterm Electron Client</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
<style type="text/css">
html, body {
  width: 100%;
  height: 100%;
  border: none;
  margin: 0;
  padding: 0;
}
</style>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', () => {
  const { hterm, lib } = require('hterm-umdjs');

  // Initialize the terminal
  hterm.defaultStorage = new lib.Storage.Local();
  const terminal = new hterm.Terminal('default');

  terminal.onTerminalReady =
    EventTarget.prototype.dispatchEvent.bind(
      document, new CustomEvent('terminalready', {
        detail: { terminal }
      })
    );

  // Apply the teminal to DOM
  terminal.decorate(document.body);

  // Expose for debugging
  window.terminal = terminal;
});
document.addEventListener('terminalready', e => {
  const { ipcRenderer } = require('electron');
  const { terminal } = e.detail;
  const io = terminal.io.push();

  // Map terminal IO to IPC channel
  ipcRenderer.on('output', (e, data) => io.print(data));
  io.onVTKeystroke = io.sendString =
    ipcRenderer.send.bind(null, 'input');
  io.onTerminalResize =
    ipcRenderer.send.bind(null, 'resize');
  ipcRenderer.send('terminal-ready');

  terminal.installKeyboard();

  // Decorate the terminal
  const prefs = terminal.getPrefs();
  prefs.changeDefault('cursor-color', '#0F8');
  prefs.changeDefault('cursor-blink', true);
  prefs.changeDefault('cursor-blink-cycle', [40, 40]);
  prefs.changeDefault('font-size', 14);
  prefs.changeDefault('color-palette-overrides', [
    '#111', '#F40', '#0F4', '#FC0',
    '#08F', '#80F', '#0F8', '#CCC',
    '#888', '#F04', '#8F0', '#FF8',
    '#44F', '#F8C', '#4FC', '#FFF'
  ]);
});
</script>
</head>
</html>
